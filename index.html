<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web Novel</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
}
header {
  padding: 15px;
  text-align: center;
  background: #111;
  font-size: 22px;
  font-weight: bold;
}
.container {
  padding: 15px;
}
input, textarea, button {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  border-radius: 8px;
  border: none;
}
button {
  background: #00c853;
  color: #000;
  font-weight: bold;
}
.card {
  background: #1c1c1c;
  padding: 15px;
  border-radius: 12px;
  margin-top: 15px;
}
.chapter-title {
  font-size: 18px;
  font-weight: bold;
}
.hidden {
  display: none;
}
</style>
</head>

<body>

<header>üìñ WEB NOVEL</header>

<!-- LOGIN -->
<div class="container" id="loginPage">
  <h3>Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- AUTHOR -->
<div class="container hidden" id="authorPage">
  <h3>‚úçÔ∏è Author Panel</h3>
  <input id="chapterTitle" placeholder="Judul Chapter">
  <textarea id="chapterContent" rows="6" placeholder="Isi Chapter"></textarea>
  <button onclick="addChapter()">Upload Chapter</button>
</div>

<!-- READER -->
<div class="container hidden" id="readerPage">
  <h3>üìö Daftar Chapter</h3>
  <div id="chapterList"></div>
</div>

<script>
/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "ISI_APIKEY",
  authDomain: "ISI_AUTHDOMAIN",
  projectId: "ISI_PROJECTID",
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* üîê LOGIN */
function login() {
  const email = email.value;
  const password = document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      checkRole();
    })
    .catch(err => alert(err.message));
}

/* üé≠ ROLE CHECK */
function checkRole() {
  const user = auth.currentUser;
  document.getElementById("loginPage").classList.add("hidden");

  if (user.email === "author@gmail.com") {
    document.getElementById("authorPage").classList.remove("hidden");
  }

  document.getElementById("readerPage").classList.remove("hidden");
  loadChapters();
}

/* ‚ûï ADD CHAPTER */
function addChapter() {
  const title = chapterTitle.value;
  const content = chapterContent.value;

  if (!title || !content) return alert("Lengkapi chapter");

  db.collection("novels")
    .doc("novel1")
    .collection("chapters")
    .add({
      title,
      content,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

  chapterTitle.value = "";
  chapterContent.value = "";
}

/* üìñ LOAD CHAPTER */
function loadChapters() {
  db.collection("novels")
    .doc("novel1")
    .collection("chapters")
    .orderBy("createdAt")
    .onSnapshot(snapshot => {
      chapterList.innerHTML = "";
      snapshot.forEach(doc => {
        const c = doc.data();
        chapterList.innerHTML += `
          <div class="card">
            <div class="chapter-title">${c.title}</div>
            <p>${c.content.replace(/\n/g,"<br>")}</p>
          </div>
        `;
      });
    });
}

/* AUTO LOGIN */
auth.onAuthStateChanged(user => {
  if (user) checkRole();
});
</script>

</body>
</html>